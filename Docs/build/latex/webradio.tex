%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{2}



\title{Web Radio}
\date{Nov 23, 2022}
\release{2022}
\author{Victor Alicino}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
\sphinxstylestrong{Web Radio} is a project developed by LabIoT Team in Parque Tecnológico de Itaipu (PTI) under the SmartOffice project.
The goals is to create a personalized radio via internet for offices.
The radio server is based on \sphinxhref{https://www.liquidsoap.info/}{Liquidsoap} and \sphinxhref{https://icecast.org/}{Icecast}.
The radio client can be any device that can play a stream from an URL, but here you will find a Python script that uses the
\sphinxhref{https://www.videolan.org/vlc/libvlc.html}{VLC library} in \sphinxhref{https://pypi.org/project/python-vlc/}{Python wrapper} to capture the HTTP
packages and play the audio.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
This project is under active development and
comes with no garanties.
\end{sphinxadmonition}

\sphinxstepscope


\chapter{Server Installation}
\label{\detokenize{server_install:server-installation}}\label{\detokenize{server_install::doc}}
\sphinxAtStartPar
This document describes how to install the Web Radio application on any computer running Linux
(preferably Debian based distros).

\sphinxAtStartPar
For the server, we are going to need Icecast and Liquidsoap, and optionally we can also use Nginx as a reverse proxy.


\section{Icecast 2}
\label{\detokenize{server_install:icecast-2}}
\sphinxAtStartPar
The official documentation for Icecast can be found on \sphinxurl{https://icecast.org/docs/icecast-trunk/}

\sphinxAtStartPar
For Linux users with Debian based distros, I highly recommend using the Advanced Package Tool.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo apt\PYGZhy{}get install icecast2
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Make sure to use icecast2 version 2.4.4 or higher
\end{sphinxadmonition}


\section{Liquidsoap}
\label{\detokenize{server_install:liquidsoap}}
\sphinxAtStartPar
The official documentation for Liquidsoap can be found on \sphinxurl{https://www.liquidsoap.info/doc-2.1.2/}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
This documentation version can only be trusted for Liquidsoap version 2.1.2 or above
\end{sphinxadmonition}

\sphinxAtStartPar
Liquidsoap can also be installed via Advanced Package Tool, but the official documentation
recommends installing it using the OCaml Package Manager (OPAM), so, let’s install it.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Liquidsoap official documentation also provides a docker container, see more at
\sphinxurl{https://www.liquidsoap.info/doc-2.1.2/install.html\#docker}
\end{sphinxadmonition}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo apt\PYGZhy{}get install opam
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Make sure your OPAM is at least version 2.0.

\sphinxAtStartPar
Make sure your OCaml is at least version 4.12.0
\end{sphinxadmonition}

\sphinxAtStartPar
For Liquidsoap to work properly you will need some dependencies, you can install all of them
in a single command, but make sure to get yourself some coffee, this is going to take a while.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
For a list of all the dependencies available, run \sphinxcode{\sphinxupquote{opam info liquidsoap}}
\end{sphinxadmonition}

\sphinxAtStartPar
First, make sure you have all the external dependencies needed in order to correct install the
dependencies you want, this can be accomplished by running the \sphinxcode{\sphinxupquote{opam depext command}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
opam depext taglib mad lame vorbis cry samplerate liquidsoap
\end{sphinxVerbatim}

\sphinxAtStartPar
After that you can install,

\begin{sphinxVerbatim}[commandchars=\\\{\}]
opam install taglib mad lame vorbis cry samplerate liquidsoap
\end{sphinxVerbatim}

\sphinxAtStartPar
For Liquidsoap to be able to run as daemon, we need the liquidsoap\sphinxhyphen{}daemon package.
Clone the liquidsoap\sphinxhyphen{}daemon repository in a convenient path.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
git clone https://github.com/savonet/liquidsoap\PYGZhy{}daemon.git
\end{sphinxVerbatim}

\sphinxstepscope


\chapter{Server Configuration}
\label{\detokenize{server_config:server-configuration}}\label{\detokenize{server_config::doc}}

\section{Icecast2}
\label{\detokenize{server_config:icecast2}}
\sphinxAtStartPar
First we have to configure the Icecast.

\sphinxAtStartPar
Icecast configuration is done by a XML file located in \sphinxcode{\sphinxupquote{/etc/icecast2/icecast.xml}}.

\sphinxAtStartPar
Choose your editor of choice and open this file (you will need sudo).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo nano /etc/icecast2/icecast.xml
\end{sphinxVerbatim}

\sphinxAtStartPar
Look for this line:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{\PYGZlt{}listen\PYGZhy{}socket}\PYG{n+nt}{\PYGZgt{}}
    \PYG{n+nt}{\PYGZlt{}port}\PYG{n+nt}{\PYGZgt{}}8000\PYG{n+nt}{\PYGZlt{}/port\PYGZgt{}}
    \PYG{c+cm}{\PYGZlt{}!\PYGZhy{}\PYGZhy{} \PYGZlt{}bind\PYGZhy{}address\PYGZgt{}127.0.0.1\PYGZlt{}/bind\PYGZhy{}address\PYGZgt{} \PYGZhy{}\PYGZhy{}\PYGZgt{}}
    \PYG{c+cm}{\PYGZlt{}!\PYGZhy{}\PYGZhy{} \PYGZlt{}shoutcast\PYGZhy{}mount\PYGZgt{}/stream\PYGZlt{}/shoutcast\PYGZhy{}mount\PYGZgt{} \PYGZhy{}\PYGZhy{}\PYGZgt{}}
\PYG{n+nt}{\PYGZlt{}/listen\PYGZhy{}socket\PYGZgt{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
You can change the \sphinxcode{\sphinxupquote{\textless{}port\textgreater{}}} parameter to any port you want to be the Icecast listening port, this will be
used by Liquidsoap for send the stream to Icecast.

\sphinxAtStartPar
To change the passwords you have to look for the authentication line, which look like this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{\PYGZlt{}authentication}\PYG{n+nt}{\PYGZgt{}}
    \PYG{n+nt}{\PYGZlt{}source\PYGZhy{}password}\PYG{n+nt}{\PYGZgt{}}hackme\PYG{n+nt}{\PYGZlt{}/source\PYGZhy{}password\PYGZgt{}}
    \PYG{n+nt}{\PYGZlt{}relay\PYGZhy{}password}\PYG{n+nt}{\PYGZgt{}}hackme\PYG{n+nt}{\PYGZlt{}/relay\PYGZhy{}password\PYGZgt{}}
    \PYG{n+nt}{\PYGZlt{}admin\PYGZhy{}user}\PYG{n+nt}{\PYGZgt{}}admin\PYG{n+nt}{\PYGZlt{}/admin\PYGZhy{}user\PYGZgt{}}
    \PYG{n+nt}{\PYGZlt{}admin\PYGZhy{}password}\PYG{n+nt}{\PYGZgt{}}hackme\PYG{n+nt}{\PYGZlt{}/admin\PYGZhy{}password\PYGZgt{}}
\PYG{n+nt}{\PYGZlt{}/authentication\PYGZgt{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
After that you can restart Icecast to load de changes.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo service icecast2 restart
\end{sphinxVerbatim}


\section{NGINX}
\label{\detokenize{server_config:nginx}}
\sphinxAtStartPar
If you want to use NGINX as a reverse proxy, you can create a new NGINX configuration file for Icecast.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo nano /etc/nginx/conf.d/icecast.conf
\end{sphinxVerbatim}

\sphinxAtStartPar
And add this content:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{server}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{k+kn}{listen}\PYG{+w}{ }\PYG{l+m+mi}{80}\PYG{p}{;}
\PYG{+w}{    }\PYG{k+kn}{server\PYGZus{}name}\PYG{+w}{ }\PYG{l+s}{YOUR\PYGZus{}URL\PYGZus{}HERE}\PYG{p}{;}

\PYG{+w}{    }\PYG{k+kn}{location}\PYG{+w}{ }\PYG{l+s}{/}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{k+kn}{proxy\PYGZus{}pass}\PYG{+w}{ }\PYG{l+s}{http://localhost:8000}\PYG{p}{;}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
Save the file and run the following command to test the configuration:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo nginx \PYGZhy{}t
\end{sphinxVerbatim}

\sphinxAtStartPar
If the configuration is correct, you can restart NGINX:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo systemctl restart nginx
\end{sphinxVerbatim}


\section{Liquidsoap}
\label{\detokenize{server_config:liquidsoap}}
\sphinxAtStartPar
For liquidsoap to work properly, you will have to modify some script lines.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Step 1: Connect to Icecast
\begin{quote}

\sphinxAtStartPar
Inside the \sphinxcode{\sphinxupquote{Server/scripts/}} folder, locate the \sphinxcode{\sphinxupquote{streamer\_config.liq}} file, this file contains the streamer
information, in our case, the Icecast.

\sphinxAtStartPar
In \sphinxcode{\sphinxupquote{streamer\_config.liq}} modify the following lines:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{streamer\PYGZus{}host} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{localhost}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{streamer\PYGZus{}port} \PYG{o}{=} \PYG{l+m+mi}{8000}
\PYG{n}{streamer\PYGZus{}pass} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{hackme}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
Change the \sphinxcode{\sphinxupquote{streamer\_host}} to the IP of your server, the \sphinxcode{\sphinxupquote{streamer\_port}} to the port you configured in Icecast
and the \sphinxcode{\sphinxupquote{streamer\_pass}} to the password you configured in Icecast.
\end{quote}

\item {} 
\sphinxAtStartPar
Step 2: Set the correct paths
\begin{quote}

\sphinxAtStartPar
Inside the \sphinxcode{\sphinxupquote{Server/scripts/}} folder, locate the \sphinxcode{\sphinxupquote{main.liq}} file, this is the main file of the script.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{log}\PYG{o}{.}\PYG{n}{file}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{set}\PYG{o}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{PATH\PYGZhy{}TO\PYGZhy{}LOG/log/history.log}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
On line 4, change the \sphinxcode{\sphinxupquote{PATH\sphinxhyphen{}TO\sphinxhyphen{}LOG}} string to the desired path of the log file.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{playlists} \PYG{o}{=} \PYG{n}{file}\PYG{o}{.}\PYG{n}{ls}\PYG{o}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{PATH\PYGZhy{}TO\PYGZhy{}PLAYLISTS}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
On line 9, change the \sphinxcode{\sphinxupquote{PATH\sphinxhyphen{}TO\sphinxhyphen{}PLAYLITS}} string to the desired path of the playlists folders.

\sphinxAtStartPar
Locate the file \sphinxcode{\sphinxupquote{radio.liq}},

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{s} \PYG{o}{=} \PYG{n}{mksafe}\PYG{o}{(}\PYG{n}{playlist}\PYG{o}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{PATH\PYGZhy{}TO\PYGZhy{}PLAYLISTS/\PYGZsh{}\PYGZob{}list\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{)}\PYG{o}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
on line 9, change the \sphinxcode{\sphinxupquote{PATH\sphinxhyphen{}TO\sphinxhyphen{}PLAYLISTS}} with the same path to the playlists folder.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Inside the playlists folders, every different folder will generate a different stream with the files of the folder.
\end{sphinxadmonition}
\end{quote}

\item {} 
\sphinxAtStartPar
Step 3: Make it a daemon
\begin{quote}

\sphinxAtStartPar
Copy the \sphinxcode{\sphinxupquote{script}} folder to \sphinxcode{\sphinxupquote{liquidsoap\sphinxhyphen{}daemon}} directory.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
cp \PYGZhy{}r PATH\PYGZhy{}TO\PYGZhy{}REPOSITORY/Server/script \PYGZti{}/liquidsoap\PYGZhy{}daemon/
\end{sphinxVerbatim}

\sphinxAtStartPar
Run \sphinxcode{\sphinxupquote{daemonize\sphinxhyphen{}liquidsoap.sh \textless{}script\sphinxhyphen{}name\textgreater{}}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZti{}/liquidsoap\PYGZhy{}daemon/daemonize\PYGZhy{}liquidsoap.sh \PYGZti{}/liquidsoap\PYGZhy{}daemon/script/webradio.liq
\end{sphinxVerbatim}

\sphinxAtStartPar
Start the Systemd service.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo systemctl start webradio\PYGZhy{}liquidsoap
\end{sphinxVerbatim}
\end{quote}

\end{enumerate}

\sphinxstepscope


\chapter{Client Installation}
\label{\detokenize{client_install:client-installation}}\label{\detokenize{client_install::doc}}
\sphinxAtStartPar
The WebRadio is a HTTP stream, so it can be played with any web browser or player that supports this format.

\sphinxAtStartPar
Bundled with this project is a client script written in Python that can listen to the stream and play it on the
local machine, it also can be controlled via MQTT. It is located in the \sphinxtitleref{Client} directory.


\section{Python dependencies}
\label{\detokenize{client_install:python-dependencies}}
\sphinxAtStartPar
The client script requires the following Python modules:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} \begin{description}
\item[{Eclipse Paho MQTT Client}] \leavevmode
\sphinxAtStartPar
Get it by running \sphinxtitleref{pip install paho\sphinxhyphen{}mqtt}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
pip install paho\PYGZhy{}mqtt
\end{sphinxVerbatim}

\end{description}

\item {} \begin{description}
\item[{Python VLC bindings}] \leavevmode
\sphinxAtStartPar
Get it by running \sphinxtitleref{pip install python\sphinxhyphen{}vlc}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
pip install python\PYGZhy{}vlc
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
You will need the LibVLC for this to work, you can get it from the Advanced Packaging Tool (APT)
by running \sphinxcode{\sphinxupquote{sudo apt\sphinxhyphen{}get install vlc}} or from the official website.
\end{sphinxadmonition}

\end{description}

\end{enumerate}


\section{Configuration file}
\label{\detokenize{client_install:configuration-file}}
\sphinxAtStartPar
The client script requires a configuration file to be able to connect to the MQTT broker and the WebRadio stream.
The configuration file is located in the \sphinxtitleref{Client} directory and is called \sphinxtitleref{config.json}.

\sphinxAtStartPar
The configuration file is a JSON file with the following structure:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{n+nt}{\PYGZdq{}mqtt\PYGZus{}config\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}server\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}192.168.1.1\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}port\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{1883}\PYG{p}{,}\PYG{+w}{ }\PYG{n+nt}{\PYGZdq{}user\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kc}{null}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}password\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kc}{null}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}topic\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}\PYGZdq{}}
\PYG{+w}{    }\PYG{p}{\PYGZcb{},}
\PYG{+w}{    }\PYG{n+nt}{\PYGZdq{}speaker\PYGZus{}config\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}Speaker 1\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}volume\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{70}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}mute\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kc}{false}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}sources\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{p}{[}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}LabIoT Radio\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{                }\PYG{n+nt}{\PYGZdq{}type\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}WebRadio\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{                }\PYG{n+nt}{\PYGZdq{}path\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}http://192.168.1.106:8000/labiot\PYGZhy{}radio.ogg\PYGZdq{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{},}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}Ambiente\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{                }\PYG{n+nt}{\PYGZdq{}type\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}WebRadio\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{                }\PYG{n+nt}{\PYGZdq{}path\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}http://us5.internet\PYGZhy{}radio.com:8201/stream?type=http\PYGZam{}nocache=237663\PYGZdq{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{]}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{mqtt\_config}} section contains the configuration for the MQTT broker, the \sphinxcode{\sphinxupquote{server}} and \sphinxcode{\sphinxupquote{port}} are required.
The \sphinxcode{\sphinxupquote{user}} and \sphinxcode{\sphinxupquote{password}} are optional, if they are not provided the script will try to connect to the broker
without login. The \sphinxcode{\sphinxupquote{topic}} is the MQTT topic that the script will subscribe to, it is optional.

\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{speaker\_config}} section contains the configuration for the listener, the \sphinxcode{\sphinxupquote{name}} is the name of the speaker
which will be used to identify it on the MQTT server. The \sphinxcode{\sphinxupquote{volume}} is the volume of the player when it starts,
mute also define whether the player will start muted or not. The \sphinxcode{\sphinxupquote{sources}} is a list of sources that the player
can choose from, the \sphinxcode{\sphinxupquote{name}} is the name of the source, the \sphinxcode{\sphinxupquote{type}} is the type of the source and the \sphinxcode{\sphinxupquote{path}}
is the path to the source. Although the path is supposed to be an URL, it can be a local path to a file.


\section{Systemd service}
\label{\detokenize{client_install:systemd-service}}
\sphinxAtStartPar
The client script can be run as a systemd service, to do so, copy the \sphinxcode{\sphinxupquote{WebRadioClient.service}} file to
\sphinxcode{\sphinxupquote{/etc/systemd/system/}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo cp WebRadio/Client/WebRadioClient.service /etc/systemd/system/
\end{sphinxVerbatim}

\sphinxAtStartPar
Then, edit the file and change the \sphinxcode{\sphinxupquote{ExecStart}} line to point to the script location.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo nano /etc/systemd/system/WebRadioClient.service
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{[Unit]}
\PYG{n+na}{Description}\PYG{o}{=}\PYG{l+s}{Web Radio Player by LabIoT}
\PYG{n+na}{After}\PYG{o}{=}\PYG{l+s}{multi\PYGZhy{}user.target}

\PYG{k}{[Service]}
\PYG{n+na}{Type}\PYG{o}{=}\PYG{l+s}{simple}
\PYG{n+na}{User}\PYG{o}{=}\PYG{l+s}{YOUR\PYGZus{}USERNAME}
\PYG{n+na}{Restart}\PYG{o}{=}\PYG{l+s}{always}
\PYG{n+na}{ExecStart}\PYG{o}{=}\PYG{l+s}{/usr/bin/python3 \PYGZti{}/WebRadio/Client/main.py}

\PYG{k}{[Install]}
\PYG{n+na}{WantedBy}\PYG{o}{=}\PYG{l+s}{multi\PYGZhy{}user.target}
\end{sphinxVerbatim}

\sphinxAtStartPar
Then, enable and start the service.

\sphinxstepscope


\chapter{Client Controls}
\label{\detokenize{client_guide:client-controls}}\label{\detokenize{client_guide::doc}}
\sphinxAtStartPar
The client provided in this repository can only be controlled via MQTT.
All commands can be send to an unique topic, but this topic must be exclusive for the client.

\sphinxAtStartPar
The topic is defined in the configuration file and can be changed to whatever you want.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The configuration file is loaded when the client starts. If you change the configuration file, you must restart
the client service.
\end{sphinxadmonition}

\sphinxAtStartPar
The client can be controlled via the following commands:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{play}}: Alters the player state to play the stream.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pause}}: Alters the player state to paused.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{stop}}: Stop the stream.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{mute}}: Mute the stream.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{unmute}}: Unmute the stream.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{volume+}}: Increases the volume in 20.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{volume\sphinxhyphen{}}}: Decreases the volume in 20.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{volume=}}: Alters the volume of the stream. The volume must be between 0 and 100.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{source=}}: Changes the stream source. The source must be one of the sources defined in the configuration file.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{add\_source=}}: Adds a new source to the stream. The source will also be added to the configuration file.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{remove\_source=}}: Removes a source from the stream. The source will also be removed from the configuration file.

\end{itemize}


\begin{fulllineitems}

\pysigstartsignatures
\pysigline{\sphinxbfcode{\sphinxupquote{Examples:}}}
\pysigstopsignatures

\begin{fulllineitems}

\pysigstartsignatures
\pysigline{\sphinxbfcode{\sphinxupquote{play}}}
\pysigstopsignatures
\sphinxAtStartPar
..code\sphinxhyphen{}block:: bash
\begin{quote}

\sphinxAtStartPar
mosquitto\_pub \sphinxhyphen{}h localhost \sphinxhyphen{}t {\color{red}\bfseries{}\textasciigrave{}\textasciigrave{}}SPEAKER TOPIC\textasciigrave{} \sphinxhyphen{}m “play”
\end{quote}

\end{fulllineitems}


\end{fulllineitems}



\chapter{Indices and tables}
\label{\detokenize{index:indices-and-tables}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{modindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{search}

\end{itemize}



\renewcommand{\indexname}{Index}
\printindex
\end{document}